<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Family Trip to Tokyo & Nagoya 2025-2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'snow-white': '#F0FFFF',
                        'ice-blue': '#B3E5FC',
                        'light-snow-blue': '#E5F3F7',
                        'deep-sea-blue': '#01579B',
                        'accent-yellow': '#FFD54F',
                        'soft-gray': '#F5F5F5',
                        'sakura-pink': '#F8BBD0'
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body {
            background-color: #E5F3F7; 
            -webkit-tap-highlight-color: transparent;
            font-family: 'Noto Sans TC', sans-serif;
            color: #334155;
        }
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #ffffff; 
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.05);
            position: relative;
            padding-bottom: 90px;
        }
        .header-bg {
            background-color: #ffffff; 
            padding: 0; 
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15); 
            border-bottom-left-radius: 35px; 
            border-bottom-right-radius: 35px;
            z-index: 10; 
            padding-bottom: 0px; 
        }
        
        .header-image-container {
            width: 100%;
            height: 250px; 
            overflow: hidden;
            background-color: transparent; 
            border-bottom-left-radius: 35px; 
            border-bottom-right-radius: 35px;
        }
        
        .header-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            display: block; 
        }
        
        .snow-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="%23fff" opacity="0.8"/><circle cx="20" cy="80" r="0.5" fill="%23fff" opacity="0.6"/><circle cx="70" cy="30" r="1.5" fill="%23fff" opacity="0.9"/></svg>');
            background-size: 100px 100px;
            opacity: 0.7;
            animation: snowfall 10s linear infinite;
            z-index: 5;
        }
        @keyframes snowfall {
            to {
                background-position: 100px 100px;
            }
        }
        
        .side-tab-bar {
            position: absolute;
            bottom: 45px; 
            right: 16px;
            z-index: 30; 
            display: flex;
            flex-direction: row;
            gap: 8px; 
        }
        
        .tab-button {
            width: 40px; 
            height: 40px;
            border-radius: 9999px; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); 
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            background-color: #01579B;
            color: #ffffff;
            box-shadow: 0 6px 15px rgba(1, 87, 155, 0.4); 
            transform: scale(1.05);
        }
        
        .tab-button:not(.active) {
            background-color: #ffffff;
            color: #B3E5FC;
        }
        .app-main {
            padding-top: 25px !important; 
            position: relative;
            z-index: 5;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none; 
        }
        .card-shadow {
            box-shadow: 0 4px 20px rgba(179, 229, 252, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fab-shadow {
            box-shadow: 0 4px 15px rgba(255, 213, 79, 0.5);
        }
        .note-content {
            max-height: 2.5rem;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .note-content.expanded {
            max-height: 500px;
        }
        
        .expense-category-tag {
            min-width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .expenses-banner {
            background: linear-gradient(135deg, #01579B 0%, #0097A7 100%);
        }
        
        .date-selector-sticky {
            background-color: #ffffff;
            border-bottom: 1px solid #f0f0f0; 
            z-index: 20; 
            top: 0; 
        }
    </style>
</head>
<body>
<div id="app" class="app-container">
    <div class="header-bg relative">
        <div class="header-image-container">
            <img src="IMG_4330.PNG" alt="東京&名古屋家族旅行計畫">
        </div>
        
        <div class="snow-layer"></div> 
        
        <div class="side-tab-bar">
            <button @click="currentTab = 'itinerary'" title="行程" 
                    :class="{'active': currentTab === 'itinerary'}" 
                    class="tab-button">
                <i class="fa-solid fa-map-location-dot"></i>
            </button>
            
            <button @click="currentTab = 'info'" title="資訊" 
                    :class="{'active': currentTab === 'info'}" 
                    class="tab-button">
                <i class="fa-solid fa-circle-info"></i>
            </button>
            
            <button @click="currentTab = 'shopping'" title="購物" 
                    :class="{'active': currentTab === 'shopping'}" 
                    class="tab-button">
                <i class="fa-solid fa-basket-shopping"></i>
            </button>
            
            <button @click="currentTab = 'expenses'" title="花費" 
                    :class="{'active': currentTab === 'expenses'}" 
                    class="tab-button">
                <i class="fa-solid fa-coins"></i>
            </button>
        </div>
    </div>
    
    <main class="p-4 app-main">
        
        <div v-if="currentTab === 'itinerary'" class="animate-fade-in">
            
            <div class="flex overflow-x-auto hide-scrollbar space-x-3 pb-4 mb-2 snap-x px-1 sticky date-selector-sticky pt-1 -mx-4 px-4">
                <div v-for="(day, index) in dates" :key="index" 
                     @click="selectedDateIndex = index"
                     class="snap-center flex-shrink-0 w-[58px] h-[68px] rounded-xl flex flex-col items-center justify-center cursor-pointer transition-all duration-300 border-2 shadow-sm"
                     :class="selectedDateIndex === index ?
'bg-deep-sea-blue text-white border-deep-sea-blue shadow-lg scale-105' : 'bg-white text-slate-400 border-white hover:bg-soft-gray'">
                    
                    <span class="text-sm font-bold uppercase tracking-wider">{{ day.weekday }}</span> 
                    <span class="text-xs font-medium opacity-70">{{ day.date }}</span> 
                </div>
            </div>
            <div v-if="weatherData[selectedDateIndex]" class="mb-4 bg-snow-white border border-ice-blue rounded-2xl p-4 flex justify-between items-center shadow-md">
                <div class="flex items-start text-deep-sea-blue space-x-4">
                    <i :class="getWeatherIcon(weatherData[selectedDateIndex].condition)" class="text-5xl text-blue-500"></i>
                    
                    <div class="pt-1">
                        <span class="text-3xl font-extrabold leading-none">{{ weatherData[selectedDateIndex].temp.split('/')[0] }}°</span>
                        <span class="text-sm font-light text-slate-500 ml-1">/ {{ weatherData[selectedDateIndex].temp.split('/')[1] }}°C</span>
                        <span class="block text-xs text-slate-600 mt-1">體感: {{ weatherData[selectedDateIndex].feel }}°C</span> 
                    </div>
                </div>
                <div class="text-right text-xs text-slate-600 pl-3">
                    <span class="font-bold block text-slate-700">{{ getWeatherDescription(weatherData[selectedDateIndex].condition) }}</span>
                    
                    <span class="mt-1 block text-slate-400">本日步行/大眾運輸</span>
                </div>
            </div>
            <div class="space-y-4">
                <div v-for="(item, idx) in currentItinerary" :key="item.id" class="relative group">
                    
                    <div v-if="idx > 0" class="pl-8 pb-2 flex items-center text-xs text-slate-400">
                        <div class="h-6 w-0.5 bg-slate-200 absolute left-6 -top-3"></div>
                        
                        <i :class="getTransportIcon(currentItinerary[idx].transportType)" 
                            class="mr-2 text-slate-300 cursor-pointer hover:text-deep-sea-blue transition-colors" 
                           @click="openMapDirections(currentItinerary[idx - 1], item)">
                        </i>
                        <span class="font-bold">{{ item.travelTime || '約 15 分鐘' }}</span>
                    </div>
                    
                    <div class="bg-white rounded-3xl p-5 card-shadow relative overflow-hidden flex items-start border border-ice-blue/50">
                        
                        <div class="mr-4 flex flex-col items-center min-w-[50px]">
                            <div class="p-2 rounded-full text-white shadow-md text-base mb-1" :class="getCategoryColor(item.category)">
                                <i :class="getCategoryIcon(item.category)"></i>
                            </div>
                            <span v-if="item.startTime" class="text-xs font-bold text-slate-600 mt-1">{{ item.startTime }}</span>
                        </div>
                        <div class="flex-1 pb-1">
                            <h3 class="text-lg font-bold text-slate-800 mb-1 leading-tight pr-8">{{ item.name }}</h3>
                            
                            <div class="text-sm text-slate-500 space-y-1.5 mt-2">
                                <p v-if="item.hours" class="flex items-center"><i class="fa-regular fa-clock w-4 text-center mr-2 text-ice-blue"></i> 營業: {{ item.hours }}</p>
                                <p v-if="item.price" class="flex items-center"><i class="fa-solid fa-ticket w-4 text-center mr-2 text-ice-blue"></i> 門票/費用: {{ item.price }}</p>
                                <p v-if="item.address" class="flex items-start"><i class="fa-solid fa-location-dot w-4 text-center mr-2 mt-1 text-ice-blue"></i> {{ item.address }}</p>
                            </div>
                            <div v-if="item.note && item.note.length > 0" class="mt-3 text-xs bg-slate-50 p-2.5 rounded-lg border border-slate-100">
                                <p class="text-slate-600 font-bold mb-1 flex items-center">
                                    <i class="fa-solid fa-highlighter text-accent-yellow mr-2"></i> 備註
                                </p>
                                <div class="note-content" :class="{'expanded': item.isNoteExpanded}">
                                    {{ item.note }}
                                </div>
                                <button v-if="item.note.length > 50" @click="item.isNoteExpanded = !item.isNoteExpanded" class="text-deep-sea-blue font-bold mt-1 block">
                                    {{ item.isNoteExpanded ? '收合備註' : '查看更多...' }}
                                </button>
                            </div>
                        </div>
                        <div class="absolute top-3 right-3 flex flex-col space-y-1">
                            <button v-if="idx > 0" @click.stop="moveItineraryUp(item.id)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-300 transition-colors" title="上移">
                                <i class="fa-solid fa-arrow-up"></i>
                            </button>
                            <button v-if="idx < currentItinerary.length - 1" @click.stop="moveItineraryDown(item.id)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-300 transition-colors" title="下移">
                                <i class="fa-solid fa-arrow-down"></i>
                            </button>
                            <button @click.stop="openMap(item.address || item.name)" class="w-7 h-7 bg-ice-blue text-deep-sea-blue rounded-full flex items-center justify-center text-xs hover:bg-deep-sea-blue hover:text-white transition-colors" title="Google Maps 導航">
                                <i class="fa-solid fa-location-arrow"></i>
                            </button>
                            <button @click.stop="editItem(item)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-200 transition-colors" title="編輯行程">
                                <i class="fa-solid fa-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div v-if="currentItinerary.length === 0" class="text-center py-16 text-slate-300">
                    <i class="fa-solid fa-map-location-dot text-5xl mb-3 text-slate-200"></i>
                    <p class="text-sm">本日尚無行程<br>請點擊右下角新增</p>
                </div>
            </div>
        </div>
        
        <div v-if="currentTab === 'info'" class="space-y-5 animate-fade-in">
            
            <div class="bg-gradient-to-r from-deep-sea-blue to-cyan-700 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-10 -mt-10 blur-2xl"></div>
                <div class="absolute bottom-0 left-0 w-32 h-32 bg-white/10 rounded-full -ml-10 -mb-10 blur-2xl"></div>
                <h3 class="font-bold text-lg mb-4 flex items-center relative z-10"><i class="fa-solid fa-calculator mr-2"></i> 匯率換算 (JPY → HKD)</h3>
                <div class="flex items-center justify-between space-x-3 relative z-10">
                    <div class="flex-1">
                        <label class="text-[10px] text-cyan-200 block mb-1 uppercase tracking-wider">JPY (日幣)</label>
                        <input type="number" v-model="currencyInput" @input="calculateCurrency" class="w-full bg-white/20 border border-white/30 rounded-xl px-3 py-2.5 text-white placeholder-white/50 focus:outline-none focus:bg-white/30 text-lg font-bold" placeholder="¥">
                    </div>
                    <i class="fa-solid fa-arrow-right-arrow-left text-cyan-300 mt-5"></i>
                    <div class="flex-1">
                        <label class="text-[10px] text-cyan-200 block mb-1 uppercase tracking-wider">HKD (港幣)</label>
                        <div class="w-full bg-white/10 rounded-xl px-3 py-2.5 text-white text-lg font-bold border border-transparent">
                            $ {{ currencyResult }}
                        </div>
                    </div>
                </div>
                <p class="text-[10px] text-cyan-300 mt-3 text-right relative z-10">匯率基準: 0.0497</p>
            </div>
            
            <div class="bg-white rounded-3xl p-5 card-shadow">
                <h3 class="font-bold text-slate-800 mb-3 border-b border-slate-100 pb-2"><i class="fa-solid fa-plane-departure text-blue-500 mr-2"></i> 航班資訊</h3>
                <div class="space-y-4">
                    <div class="bg-blue-50 rounded-xl p-3 border border-blue-100">
                        <div class="flex justify-between text-sm font-bold text-deep-sea-blue mb-1">
                            <span>HKG 香港</span>
                            <i class="fa-solid fa-plane text-xs"></i>
                            <span>NRT 成田</span>
                        </div>
                        <div class="flex justify-between text-xs text-slate-500">
                            <span>09:20</span>
                            <span>UO848 (12/30)</span>
                            <span>14:25</span>
                        </div>
                    </div>
                    <div class="bg-orange-50 rounded-xl p-3 border border-orange-100">
                        <div class="flex justify-between text-sm font-bold text-orange-800 mb-1">
                            <span>NGO 名古屋</span>
                            <i class="fa-solid fa-plane text-xs"></i>
                            <span>HKG 香港</span>
                        </div>
                        <div class="flex justify-between text-xs text-slate-500">
                            <span>21:00</span>
                            <span>UO685 (1/11)</span>
                            <span>00:50(+1)</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-3xl p-6 card-shadow">
                <h3 class="font-bold text-slate-800 mb-4 border-b border-slate-100 pb-3"><i class="fa-solid fa-hotel text-indigo-500 mr-2"></i> 住宿資訊</h3>
                <ul class="space-y-5">
                    <li v-for="hotel in hotels" class="border-b last:border-0 pb-4 last:pb-0">
                        <div class="flex justify-between items-start group">
                            <div class="flex-1">
                                <span class="font-bold block text-slate-700 text-lg">{{ hotel.name }}</span>
                                <span class="text-xs text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full inline-block mt-1">{{ hotel.date }}</span>
                            </div>
                            <button @click="openMap(hotel.address)" class="w-8 h-8 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center group-hover:bg-indigo-500 group-hover:text-white transition-all"><i class="fa-solid fa-location-arrow text-xs"></i></button>
                        </div>
                        <div class="text-sm text-slate-500 mt-2 space-y-1">
                            <p class="flex items-start"><i class="fa-solid fa-map-pin w-4 text-center mr-2 mt-1 text-slate-300"></i> {{ hotel.address }}</p>
                        </div>
                    </li>
                </ul>
            </div>
            
            <div class="bg-red-50 rounded-3xl p-6 border border-red-100">
                <h3 class="font-bold text-red-800 mb-4"><i class="fa-solid fa-kit-medical mr-2"></i> 緊急聯絡 (日本)</h3>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <a href="tel:110" class="bg-white py-3 rounded-xl shadow-sm text-red-600 font-bold block border border-red-100 hover:bg-red-600 hover:text-white transition-all">
                        <i class="fa-solid fa-user-shield mr-1"></i> 警察 110
                    </a>
                    <a href="tel:119" class="bg-white py-3 rounded-xl shadow-sm text-red-600 font-bold block border border-red-100 hover:bg-red-600 hover:text-white transition-all">
                        <i class="fa-solid fa-truck-medical mr-1"></i> 救護 119
                    </a>
                </div>
            </div>
        </div>
        
        <div v-if="currentTab === 'shopping'" class="animate-fade-in">
            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-2xl p-3 card-shadow relative group">
                    <div class="aspect-square bg-slate-50 rounded-xl mb-3 overflow-hidden relative border border-slate-100">
                        <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center text-slate-300">
                            <i class="fa-solid fa-bag-shopping text-3xl"></i>
                        </div>
                        <button @click="removeShoppingItem(idx)" class="absolute top-2 right-2 bg-black/60 text-white rounded-full w-7 h-7 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>
                    <p class="font-bold text-sm text-slate-800 truncate px-1">{{ item.name }}</p>
                </div>
                
                <div v-if="shoppingList.length % 2 !== 0" class="h-0 invisible"></div>
                
                <div v-if="shoppingList.length === 0" class="col-span-2 text-center py-16 text-slate-300">
                    <i class="fa-solid fa-bag-shopping text-5xl mb-3 text-slate-200"></i>
                    <p class="text-sm">購物清單空白<br>請點擊右下角新增</p>
                </div>
            </div>
        </div>
        
        <div v-if="currentTab === 'expenses'" class="animate-fade-in">
            <div class="expenses-banner text-white rounded-3xl p-8 mb-6 relative overflow-hidden">
                <div class="absolute -right-10 -top-10 bg-white/10 w-48 h-48 rounded-full blur-3xl"></div>
                <div class="absolute -left-10 -bottom-10 bg-ice-blue/20 w-40 h-40 rounded-full blur-2xl"></div>
                <p class="text-sm text-cyan-200 mb-2 relative z-10">目前總花費 (JPY)</p>
                <h2 class="text-5xl font-bold relative z-10 tracking-tight">¥ {{ formatNumber(totalExpensesJPY) }}</h2>
                <p class="text-sm text-right mt-2 opacity-80 relative z-10">約 HK$ {{ formatNumber(totalExpensesHKD) }}</p>
            </div>
            <div class="bg-white rounded-t-3xl min-h-[500px] p-6 shadow-[0_-10px_40px_rgba(0,0,0,0.03)] -mx-4 px-8">
                <h3 class="font-bold text-slate-800 mb-5 flex items-center">
                    <i class="fa-solid fa-receipt text-slate-300 mr-2"></i>支出紀錄
                </h3>
                <div class="space-y-5">
                    <div v-for="(exp, idx) in expenses" :key="idx" class="flex items-center justify-between border-b border-slate-50 pb-4 last:border-0">
                        <div class="flex items-center">
                            <div class="expense-category-tag mr-4" :class="[getCategoryColor(exp.category), 'text-white']">
                                {{ getCategoryLabel(exp.category) }}
                            </div>
                            <div>
                                <p class="font-bold text-slate-700 text-sm mb-0.5">{{ exp.name }}</p>
                                <p class="text-[10px] text-slate-400 uppercase tracking-wide">{{ exp.date }} · {{ exp.payment === 'card' ? '信用卡' : '現金' }}</p>
                            </div>
                        </div>
                        <div class="text-right flex items-center">
                            <p class="font-bold text-slate-700">¥{{ formatNumber(exp.amount) }}</p>
                            <button @click="removeExpense(idx)" class="w-5 h-5 ml-3 text-red-300 hover:text-red-500 transition-colors flex items-center justify-center">
                                <i class="fa-solid fa-xmark text-lg"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <button v-if="currentTab !== 'info'" @click="handleAddClick" class="fixed bottom-6 right-6 w-14 h-14 bg-accent-yellow rounded-full fab-shadow text-deep-sea-blue text-2xl flex items-center justify-center hover:scale-110 transition-transform z-40">
        <i class="fa-solid fa-plus"></i>
    </button>
    
    <div v-if="showShoppingModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
            <h3 class="font-bold text-lg mb-5 text-center text-slate-800">新增購物清單</h3>
            <input v-model="newShoppingItem.name" type="text" placeholder="商品名稱" class="w-full bg-slate-50 border-none rounded-xl p-4 mb-4 focus:ring-2 focus:ring-deep-sea-blue text-sm">
            <div class="relative mb-6">
                <input type="file" @change="handleImageUpload" class="hidden" id="fileInput">
                <label for="fileInput" class="w-full h-36 bg-slate-50 border-2 border-dashed border-slate-200 rounded-xl flex items-center justify-center cursor-pointer text-slate-400 hover:bg-slate-100 hover:border-slate-300 transition-all">
                    <span v-if="!newShoppingItem.image" class="flex flex-col items-center text-xs">
                        <i class="fa-solid fa-camera text-2xl mb-2"></i> 上傳照片
                    </span>
                    <img v-else :src="newShoppingItem.image" class="h-full w-full object-contain rounded-xl">
                </label>
            </div>
            <div class="flex space-x-3">
                <button @click="showShoppingModal = false" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm">取消</button>
                <button @click="addShoppingItem" class="flex-1 py-3 rounded-xl bg-deep-sea-blue text-white font-bold text-sm shadow-lg shadow-deep-sea-blue/30">新增</button>
            </div>
        </div>
    </div>
    
    <div v-if="showExpenseModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
            <h3 class="font-bold text-lg mb-5 text-center text-slate-800">記一筆</h3>
            <div class="grid grid-cols-2 gap-3 mb-4">
                <input v-model="newExpense.date" type="date" class="bg-slate-50 rounded-xl p-3 text-sm text-slate-600 outline-none">
                <select v-model="newExpense.category" class="bg-slate-50 rounded-xl p-3 text-sm text-slate-600 outline-none">
                    <option value="food">飲食</option>
                    <option value="shopping">購物</option>
                    <option value="transport">交通</option>
                    <option value="stay">住宿</option>
                    <option value="ticket">門票</option>
                    <option value="other">其他</option>
                </select>
            </div>
            <input v-model="newExpense.name" placeholder="名稱 (如: 湯咖哩)" class="w-full bg-slate-50 rounded-xl p-4 mb-4 text-sm outline-none focus:ring-2 focus:ring-accent-yellow">
            <div class="relative mb-4">
                <span class="absolute left-4 top-4 text-slate-400 font-bold">¥</span>
                <input v-model.number="newExpense.amount" type="number" placeholder="金額" class="w-full bg-slate-50 rounded-xl p-4 pl-8 text-sm outline-none focus:ring-2 focus:ring-accent-yellow font-bold text-lg">
            </div>
            <div class="flex space-x-3 mb-6">
                <button @click="newExpense.payment='cash'" :class="newExpense.payment==='cash' ? 'bg-deep-sea-blue text-white' : 'bg-slate-100 text-slate-500'" class="flex-1 py-3 rounded-xl text-sm transition-colors"><i class="fa-solid fa-coins mr-1"></i> 現金</button>
                <button @click="newExpense.payment='card'" :class="newExpense.payment==='card' ? 'bg-deep-sea-blue text-white' : 'bg-slate-100 text-slate-500'" class="flex-1 py-3 rounded-xl text-sm transition-colors"><i class="fa-solid fa-credit-card mr-1"></i> 信用卡</button>
            </div>
            <div class="flex space-x-3">
                <button @click="showExpenseModal = false" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm">取消</button>
                <button @click="addExpense" class="flex-1 py-3 rounded-xl bg-accent-yellow text-deep-sea-blue font-bold text-sm shadow-lg shadow-accent-yellow/30">儲存</button>
            </div>
        </div>
    </div>
    
    <div v-if="showItineraryModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
            <h3 class="font-bold text-lg mb-5 text-center text-slate-800">{{ isEditMode ? '編輯行程' : '新增行程' }}</h3>
            <div class="space-y-3">
                <select v-model="newItinerary.category" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    <option value="sightseeing">景點</option>
                    <option value="food">飲食</option>
                    <option value="shopping">購物</option>
                    <option value="accommodation">住宿</option>
                    <option value="flight">航班</option>
                    <option value="transport">交通</option>
                    <option value="ticket">門票</option>
                    <option value="other">其他</option>
                </select>
                <input v-model="newItinerary.name" placeholder="名稱" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-deep-sea-blue">
                <input v-model="newItinerary.address" placeholder="地址/地點 (Google Map 搜尋用)" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-deep-sea-blue">
                <div class="grid grid-cols-2 gap-3">
                    <input v-model="newItinerary.startTime" type="text" placeholder="時間 (e.g. 09:30)" class="bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    <select v-model="newItinerary.transportType" class="bg-slate-50 rounded-xl p-3 text-sm outline-none">
                        <option value="walk">步行</option>
                        <option value="public">地鐵/JR</option>
                        <option value="bus">巴士</option>
                        <option value="flight">飛機</option>
                        <option value="other">其他</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <input v-model="newItinerary.travelTime" type="text" placeholder="車程/移動時間" class="bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    <input v-model="newItinerary.hours" type="text" placeholder="營業時間" class="bg-slate-50 rounded-xl p-3 text-sm outline-none">
                </div>
                <input v-model="newItinerary.price" type="text" placeholder="門票/費用" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-deep-sea-blue">
                <textarea v-model="newItinerary.note" placeholder="備註/細節" rows="3" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-deep-sea-blue"></textarea>
            </div>
            <div class="flex space-x-3 mt-6">
                <button @click="showItineraryModal = false; isEditMode = false" :class="isEditMode ? 'w-1/3' : 'flex-1'" class="py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm">取消</button>
                <button v-if="isEditMode" @click="removeItineraryItem(newItinerary.id)" class="w-1/3 py-3 rounded-xl bg-red-100 text-red-600 font-bold text-sm hover:bg-red-200 transition-colors">
                    <i class="fa-solid fa-trash-can mr-1"></i> 刪除
                </button>
                <button @click="saveItineraryItem" :class="isEditMode ? 'w-1/3' : 'flex-1'" class="py-3 rounded-xl bg-deep-sea-blue text-white font-bold text-sm shadow-lg shadow-deep-sea-blue/30">{{ isEditMode ? '儲存修改' : '新增行程' }}</button>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue
    createApp({
        setup() {
            // 匯率 (JPY → HKD，2025/12/30 基準)
            const EXCHANGE_RATE = 0.0497
            
            // 類別圖示與顏色
            const CATEGORY_MAP = {
                sightseeing: { color: 'bg-green-500', icon: 'fa-solid fa-camera' },
                food: { color: 'bg-red-500', icon: 'fa-solid fa-utensils' },
                shopping: { color: 'bg-indigo-500', icon: 'fa-solid fa-bag-shopping' },
                accommodation: { color: 'bg-purple-500', icon: 'fa-solid fa-bed' },
                flight: { color: 'bg-blue-500', icon: 'fa-solid fa-plane-departure' },
                transport: { color: 'bg-orange-500', icon: 'fa-solid fa-train-subway' },
                ticket: { color: 'bg-cyan-500', icon: 'fa-solid fa-ticket' },
                other: { color: 'bg-slate-500', icon: 'fa-solid fa-circle-info' },
                stay: { color: 'bg-purple-500', icon: 'fa-solid fa-hotel' },
            }
            const CATEGORY_LABEL_MAP = {
                sightseeing: '景點', food: '飲食', shopping: '購物', accommodation: '住宿', 
                flight: '航班', transport: '交通', ticket: '門票', other: '其他', stay: '住宿'
            }

            const currentTab = ref('itinerary')
            const selectedDateIndex = ref(0)

            const dates = ref([
                { date: '12/30', weekday: '二' },
                { date: '12/31', weekday: '三' },
                { date: '1/01', weekday: '四' },
                { date: '1/02', weekday: '五' },
                { date: '1/03', weekday: '六' },
                { date: '1/04', weekday: '日' },
                { date: '1/05', weekday: '一' },
                { date: '1/06', weekday: '二' },
                { date: '1/07', weekday: '三' },
                { date: '1/08', weekday: '四' },
                { date: '1/09', weekday: '五' },
                { date: '1/10', weekday: '六' },
                { date: '1/11', weekday: '日' },
            ])

            const hotels = ref([
                { name: 'fav TOKYO NISHINIPPORI', date: '12/30 - 1/1 (D1-D3)', address: '5 Chome-31-6 Nishinippori, Arakawa City, Tokyo 116-0013 日本' },
                { name: 'Bay Hotel Urayasu-ekimae', date: '1/1 - 1/7 (D3-D9)', address: '1 Chome-15-28 Kitazakae, Urayasu, Chiba 279-0002 日本' },
                { name: '名古屋中區住宿', date: '1/7 - 1/11 (D9-D13)', address: 'Naka-ku, Nagoya-shi, Aichi-ken, 日本' },
            ])

            const itineraryData = ref([
                // D1 12/30
                [
                    { id: 101, name: '香港 → 成田機場', category: 'flight', startTime: '09:20', address: '成田國際機場', note: 'UO848，14:25抵達', transportType: 'flight', travelTime: '4h', isNoteExpanded: false },
                    { id: 102, name: '成田機場 → 日暮里', category: 'transport', startTime: '~15:30', address: '日暮里站', note: 'Keisei Skyliner 或 Narita Express', transportType: 'public', travelTime: '40m', isNoteExpanded: false },
                    { id: 103, name: '入住 fav TOKYO NISHINIPPORI', category: 'accommodation', startTime: '下午', address: 'fav TOKYO NISHINIPPORI', note: '', transportType: 'walk', travelTime: '10m', isNoteExpanded: false },
                    { id: 104, name: '日暮里 → 新宿購物', category: 'shopping', startTime: '下午~晚上', address: '新宿', note: '迪士尼新宿高島屋、SURUGA-YA、路易威登、THANK YOU MART 等', transportType: 'public', travelTime: '15m', isNoteExpanded: false },
                ],
                // D2 12/31 跨年
                [
                    { id: 201, name: '原宿購物', category: 'shopping', startTime: '上午', address: '原宿', note: 'THANK YOU MART、Sanrio、BAPE、AAPE 等', transportType: 'public', travelTime: '20m', isNoteExpanded: false },
                    { id: 202, name: '表參道奢侈品', category: 'shopping', startTime: '上午', address: '表參道', note: '路易威登、PORTER 等', transportType: 'walk', travelTime: '5m', isNoteExpanded: false },
                    { id: 203, name: '澀谷購物', category: 'shopping', startTime: '中午~下午', address: '澀谷', note: '迪士尼、Mandarake、BAPE、Sanrio 等', transportType: 'public', travelTime: '10m', isNoteExpanded: false },
                    { id: 204, name: '淺草寺跨年', category: 'sightseeing', startTime: '晚上', address: '淺草寺', note: '注意人群', transportType: 'public', travelTime: '30m', isNoteExpanded: false },
                    { id: 205, name: '返回日暮里', category: 'transport', startTime: '深夜', address: 'fav TOKYO NISHINIPPORI', note: '', transportType: 'public', travelTime: '10m', isNoteExpanded: false },
                ],
                // D3 1/1 Gala滑雪
                [
                    { id: 301, name: '日暮里 → 東京站 → Gala Yuzawa', category: 'transport', startTime: '上午', address: 'Gala Yuzawa', note: '新幹線', transportType: 'public', travelTime: '1.5h+', isNoteExpanded: false },
                    { id: 302, name: '全天滑雪', category: 'sightseeing', startTime: '全天', address: 'Gala Yuzawa', note: '', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                    { id: 303, name: '返回浦安入住', category: 'accommodation', startTime: '晚上', address: 'Bay Hotel Urayasu-ekimae', note: '', transportType: 'public', travelTime: '1.5h+20m', isNoteExpanded: false },
                ],
                // D4 1/2 池袋
                [
                    { id: 401, name: '浦安 → 池袋', category: 'transport', startTime: '上午', address: '池袋', note: '', transportType: 'public', travelTime: '40m', isNoteExpanded: false },
                    { id: 402, name: '全天池袋購物福袋', category: 'shopping', startTime: '全天', address: '池袋', note: 'Parco、Suruga-ya、Mandarake、THANK YOU MART、陽光城', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                    { id: 403, name: '返回浦安', category: 'transport', startTime: '晚上', address: 'Bay Hotel Urayasu-ekimae', note: '', transportType: 'public', travelTime: '40m', isNoteExpanded: false },
                ],
                // D5 1/3 上野 & 中野
                [
                    { id: 501, name: '浦安 → 上野', category: 'transport', startTime: '上午', address: '上野', note: '', transportType: 'public', travelTime: '30m', isNoteExpanded: false },
                    { id: 502, name: '上野 Ameyoko 市場', category: 'shopping', startTime: '上午', address: '上野', note: '', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                    { id: 503, name: '上野 → 中野百老匯', category: 'transport', startTime: '下午', address: '中野百老匯', note: '', transportType: 'public', travelTime: '15m', isNoteExpanded: false },
                    { id: 504, name: '中野動漫購物', category: 'shopping', startTime: '下午', address: '中野百老匯', note: 'Mandarake 多間', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                    { id: 505, name: '午餐 Ichiyoshi Soba', category: 'food', startTime: '中午', address: '中野附近', note: '', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                    { id: 506, name: '返回浦安', category: 'transport', startTime: '晚上', address: 'Bay Hotel Urayasu-ekimae', note: '', transportType: 'public', travelTime: '40m', isNoteExpanded: false },
                ],
                // D6 1/4 迪士尼樂園
                [
                    { id: 601, name: '浦安 → 舞浜站', category: 'transport', startTime: '上午', address: '東京迪士尼樂園', note: '', transportType: 'public', travelTime: '5m', isNoteExpanded: false },
                    { id: 602, name: '全天東京迪士尼樂園', category: 'sightseeing', startTime: '全天', address: '東京迪士尼樂園', note: '', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                    { id: 603, name: '返回浦安', category: 'transport', startTime: '晚上', address: 'Bay Hotel Urayasu-ekimae', note: '', transportType: 'public', travelTime: '5m', isNoteExpanded: false },
                ],
                // D7 1/5 木更津 Outlet
                [
                    { id: 701, name: '浦安 → 木更津', category: 'transport', startTime: '上午', address: 'Mitsui Outlet Park 木更津', note: '', transportType: 'public', travelTime: '1h', isNoteExpanded: false },
                    { id: 702, name: '全天木更津 Outlet', category: 'shopping', startTime: '全天', address: 'Mitsui Outlet Park 木更津', note: '可延伸 Avail', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                    { id: 703, name: '返回浦安', category: 'transport', startTime: '晚上', address: 'Bay Hotel Urayasu-ekimae', note: '', transportType: 'public', travelTime: '1h', isNoteExpanded: false },
                ],
                // D8 1/6 迪士尼海洋
                [
                    { id: 801, name: '浦安 → 舞浜站', category: 'transport', startTime: '上午', address: '東京迪士尼海洋', note: '', transportType: 'public', travelTime: '5m', isNoteExpanded: false },
                    { id: 802, name: '全天東京迪士尼海洋', category: 'sightseeing', startTime: '全天', address: '東京迪士尼海洋', note: '', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                    { id: 803, name: '返回浦安', category: 'transport', startTime: '晚上', address: 'Bay Hotel Urayasu-ekimae', note: '', transportType: 'public', travelTime: '5m', isNoteExpanded: false },
                ],
                // D9 1/7 東京站 → 名古屋
                [
                    { id: 901, name: '浦安 → 東京站', category: 'transport', startTime: '上午', address: '東京站', note: '', transportType: 'public', travelTime: '20m', isNoteExpanded: false },
                    { id: 902, name: '東京站周邊購物', category: 'shopping', startTime: '上午', address: '東京站', note: '迪士尼旗艦店等', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                    { id: 903, name: '下午自由活動', category: 'other', startTime: '下午', address: '東京', note: '', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                    { id: 904, name: '東京站 → 名古屋', category: 'transport', startTime: '晚上', address: '名古屋', note: '新幹線', transportType: 'public', travelTime: '1.5h', isNoteExpanded: false },
                    { id: 905, name: '入住名古屋中區', category: 'accommodation', startTime: '晚上', address: '名古屋中區住宿', note: '', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                ],
                // D10 1/8 名古屋市區
                [
                    { id: 1001, name: '榮 / 大須購物', category: 'shopping', startTime: '全天', address: '榮 / 大須', note: 'ABC-MART、Xebio、Sports Depot、名古屋PARCO 等運動品牌', transportType: 'walk', travelTime: null, isNoteExpanded: false },
                ],
                // D11 1/9 白川鄉
                [
                    { id: 1101, name: '跟團白川鄉一日遊', category: 'sightseeing', startTime: '全天', address: '白川鄉', note: '合掌村冬季風情', transportType: 'other', travelTime: null, isNoteExpanded: false },
                ],
                // D12 1/10 Jazz Dream 長島
                [
                    { id: 1201, name: '三井 Outlet Park Jazz Dream 長島', category: 'shopping', startTime: '全天', address: 'Jazz Dream 長島', note: '', transportType: 'public', travelTime: null, isNoteExpanded: false },
                ],
                // D13 1/11 回程
                [
                    { id: 1301, name: '常滑招財貓通', category: 'sightseeing', startTime: '上午', address: '愛知縣常滑市 Sakaemachi', note: '', transportType: 'public', travelTime: null, isNoteExpanded: false },
                    { id: 1302, name: '名古屋 → 香港', category: 'flight', startTime: '21:00', address: '香港國際機場', note: 'UO685，00:50(+1)抵達', transportType: 'flight', travelTime: '4h50m', isNoteExpanded: false },
                ],
            ])

            const weatherData = ref([
                { condition: 'cloudy', temp: '8/2', feel: '0' },
                { condition: 'cloudy', temp: '7/1', feel: '-1' },
                { condition: 'snow', temp: '5/0', feel: '-3' },
                { condition: 'cloudy', temp: '6/1', feel: '-2' },
                { condition: 'cloudy', temp: '7/2', feel: '0' },
                { condition: 'sunny', temp: '9/3', feel: '1' },
                { condition: 'cloudy', temp: '8/2', feel: '0' },
                { condition: 'cloudy', temp: '9/3', feel: '1' },
                { condition: 'cloudy', temp: '10/4', feel: '2' },
                { condition: 'cloudy', temp: '11/5', feel: '3' },
                { condition: 'cloudy', temp: '12/6', feel: '4' },
                { condition: 'cloudy', temp: '11/5', feel: '3' },
                { condition: 'cloudy', temp: '10/4', feel: '2' },
            ])

            const shoppingList = ref([])
            const expenses = ref([])

            const showShoppingModal = ref(false)
            const showExpenseModal = ref(false)
            const showItineraryModal = ref(false)
            const isEditMode = ref(false)

            const newShoppingItem = ref({ name: '', image: null })
            const newExpense = ref({ name: '', amount: null, category: 'food', date: '2025-12-30', payment: 'cash' })
            const newItinerary = ref({ id: null, name: '', category: 'sightseeing', startTime: '', hours: '', address: '', price: '', note: '', transportType: 'public', travelTime: '', isNoteExpanded: false })

            const currencyInput = ref(10000)
            const currencyResult = ref(0)

            const currentItinerary = computed(() => itineraryData.value[selectedDateIndex.value] || [])
            const totalExpensesJPY = computed(() => expenses.value.reduce((sum, exp) => sum + exp.amount, 0))
            const totalExpensesHKD = computed(() => Math.round(totalExpensesJPY.value * EXCHANGE_RATE))

            const calculateCurrency = () => {
                currencyResult.value = Math.round(currencyInput.value * EXCHANGE_RATE)
            }

            const formatNumber = (num) => {
                if (!num) return '0'
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")
            }

            const getCategoryColor = (category) => CATEGORY_MAP[category]?.color || 'bg-slate-500'
            const getCategoryIcon = (category) => CATEGORY_MAP[category]?.icon || 'fa-solid fa-circle-info'
            const getCategoryLabel = (category) => CATEGORY_LABEL_MAP[category] || '其他'

            const getWeatherIcon = (condition) => {
                const map = {
                    snow: 'fa-solid fa-snowflake',
                    sunny: 'fa-solid fa-sun',
                    cloudy: 'fa-solid fa-cloud',
                    rain: 'fa-solid fa-cloud-showers-heavy'
                }
                return map[condition] || 'fa-solid fa-cloud'
            }

            const getWeatherDescription = (condition) => {
                const map = { snow: '雪', sunny: '晴', cloudy: '多雲', rain: '雨' }
                return map[condition] || '未知'
            }

            const getTransportIcon = (type) => {
                const map = {
                    walk: 'fa-solid fa-shoe-prints',
                    public: 'fa-solid fa-train-subway',
                    bus: 'fa-solid fa-bus-simple',
                    flight: 'fa-solid fa-plane',
                    other: 'fa-solid fa-arrow-right-long'
                }
                return map[type] || 'fa-solid fa-arrow-right-long'
            }

            const openMap = (query) => {
                if (query) window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank')
            }

            const openMapDirections = (startItem, endItem) => {
                const origin = startItem.address || startItem.name
                const destination = endItem.address || endItem.name
                if (origin && destination) {
                    const mode = endItem.transportType === 'flight' ? 'transit' : endItem.transportType === 'walk' ? 'walking' : 'transit'
                    window.open(`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(origin)}&destination=${encodeURIComponent(destination)}&travelmode=${mode}`, '_blank')
                }
            }

            const handleAddClick = () => {
                if (currentTab.value === 'itinerary') {
                    resetItineraryForm()
                    showItineraryModal.value = true
                } else if (currentTab.value === 'shopping') {
                    resetShoppingForm()
                    showShoppingModal.value = true
                } else if (currentTab.value === 'expenses') {
                    resetExpenseForm()
                    showExpenseModal.value = true
                }
            }

            const resetItineraryForm = () => {
                isEditMode.value = false
                newItinerary.value = {
                    id: Date.now(), name: '', category: 'sightseeing', startTime: '', hours: '', address: '', price: '', note: '', transportType: 'public', travelTime: '', isNoteExpanded: false
                }
            }

            const editItem = (item) => {
                isEditMode.value = true
                newItinerary.value = JSON.parse(JSON.stringify(item))
                showItineraryModal.value = true
            }

            const saveItineraryItem = () => {
                if (!newItinerary.value.name) {
                    alert('行程名稱不能為空')
                    return
                }
                if (isEditMode.value) {
                    const index = currentItinerary.value.findIndex(i => i.id === newItinerary.value.id)
                    if (index !== -1) currentItinerary.value[index] = { ...newItinerary.value }
                } else {
                    const newItem = { ...newItinerary.value, id: Date.now() }
                    itineraryData.value[selectedDateIndex.value].push(newItem)
                }
                itineraryData.value[selectedDateIndex.value] = [...currentItinerary.value]
                showItineraryModal.value = false
                isEditMode.value = false
            }

            const removeItineraryItem = (id) => {
                if (confirm('確定刪除此行程？')) {
                    const list = itineraryData.value[selectedDateIndex.value]
                    const index = list.findIndex(i => i.id === id)
                    if (index !== -1) {
                        list.splice(index, 1)
                        itineraryData.value[selectedDateIndex.value] = [...list]
                    }
                    showItineraryModal.value = false
                    isEditMode.value = false
                }
            }

            const moveItinerary = (id, direction) => {
                const list = currentItinerary.value
                const index = list.findIndex(i => i.id === id)
                if (index === -1) return
                const newIndex = index + direction
                if (newIndex >= 0 && newIndex < list.length) {
                    const item = list.splice(index, 1)[0]
                    list.splice(newIndex, 0, item)
                    itineraryData.value[selectedDateIndex.value] = [...list]
                }
            }
            const moveItineraryUp = (id) => moveItinerary(id, -1)
            const moveItineraryDown = (id) => moveItinerary(id, 1)

            const resetShoppingForm = () => {
                newShoppingItem.value = { name: '', image: null }
            }

            const handleImageUpload = (e) => {
                const file = e.target.files[0]
                if (file) {
                    const reader = new FileReader()
                    reader.onload = (ev) => newShoppingItem.value.image = ev.target.result
                    reader.readAsDataURL(file)
                }
            }

            const addShoppingItem = () => {
                if (!newShoppingItem.value.name.trim()) {
                    alert('商品名稱不能為空')
                    return
                }
                shoppingList.value.push({ ...newShoppingItem.value })
                showShoppingModal.value = false
                resetShoppingForm()
            }

            const removeShoppingItem = (idx) => shoppingList.value.splice(idx, 1)

            const resetExpenseForm = () => {
                newExpense.value = { name: '', amount: null, category: 'food', date: new Date().toISOString().slice(0,10), payment: 'cash' }
            }

            const addExpense = () => {
                if (!newExpense.value.name.trim() || !newExpense.value.amount || newExpense.value.amount <= 0) {
                    alert('請填寫名稱與有效金額')
                    return
                }
                expenses.value.push({ ...newExpense.value })
                expenses.value.sort((a,b) => new Date(b.date) - new Date(a.date))
                showExpenseModal.value = false
                resetExpenseForm()
            }

            const removeExpense = (idx) => expenses.value.splice(idx, 1)

            onMounted(() => {
                calculateCurrency()
                expenses.value.sort((a,b) => new Date(b.date) - new Date(a.date))
            })

            return {
                currentTab, dates, selectedDateIndex, currentItinerary, hotels, weatherData,
                shoppingList, expenses, totalExpensesJPY, totalExpensesHKD,
                showShoppingModal, showExpenseModal, showItineraryModal, isEditMode,
                newShoppingItem, newExpense, newItinerary,
                currencyInput, currencyResult, calculateCurrency,
                getCategoryColor, getCategoryIcon, getCategoryLabel,
                getWeatherIcon, getWeatherDescription, getTransportIcon,
                openMap, openMapDirections, formatNumber,
                handleAddClick, handleImageUpload, addShoppingItem, removeShoppingItem,
                addExpense, removeExpense, editItem, saveItineraryItem, removeItineraryItem,
                moveItineraryUp, moveItineraryDown
            }
        }
    }).mount('#app')
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Family Trip to Tokyo & Nagoya 2025-2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'snow-white': '#F0FFFF',
                        'ice-blue': '#B3E5FC',
                        'light-snow-blue': '#E5F3F7',
                        'deep-sea-blue': '#01579B',
                        'accent-yellow': '#FFD54F',
                        'soft-gray': '#F5F5F5',
                        'sakura-pink': '#F8BBD0'
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body {
            background-color: #E5F3F7; 
            -webkit-tap-highlight-color: transparent;
            font-family: 'Noto Sans TC', sans-serif;
            color: #334155;
        }
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #ffffff; 
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.05);
            position: relative;
            padding-bottom: 90px;
        }
        .header-bg {
            background-color: #ffffff; 
            padding: 0; 
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15); 
            border-bottom-left-radius: 35px; 
            border-bottom-right-radius: 35px;
            z-index: 10; 
            padding-bottom: 0px; 
        }
        
        /* 輪播容器 */
        .header-slider {
            width: 100%;
            height: 250px; 
            overflow: hidden;
            background-color: transparent; 
            border-bottom-left-radius: 35px; 
            border-bottom-right-radius: 35px;
            position: relative;
        }
        
        .slider-image {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }
        
        .slider-image.active {
            opacity: 1;
        }
        
        .snow-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="%23fff" opacity="0.8"/><circle cx="20" cy="80" r="0.5" fill="%23fff" opacity="0.6"/><circle cx="70" cy="30" r="1.5" fill="%23fff" opacity="0.9"/></svg>');
            background-size: 100px 100px;
            opacity: 0.7;
            animation: snowfall 10s linear infinite;
            z-index: 5;
        }
        @keyframes snowfall {
            to {
                background-position: 100px 100px;
            }
        }
        
        .side-tab-bar {
            position: absolute;
            bottom: 45px; 
            right: 16px;
            z-index: 30; 
            display: flex;
            flex-direction: row;
            gap: 8px; 
        }
        
        .tab-button {
            width: 40px; 
            height: 40px;
            border-radius: 9999px; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); 
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            background-color: #01579B;
            color: #ffffff;
            box-shadow: 0 6px 15px rgba(1, 87, 155, 0.4); 
            transform: scale(1.05);
        }
        
        .tab-button:not(.active) {
            background-color: #ffffff;
            color: #B3E5FC;
        }
        .app-main {
            padding-top: 25px !important; 
            position: relative;
            z-index: 5;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none; 
        }
        .card-shadow {
            box-shadow: 0 4px 20px rgba(179, 229, 252, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fab-shadow {
            box-shadow: 0 4px 15px rgba(255, 213, 79, 0.5);
        }
        .note-content {
            max-height: 2.5rem;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .note-content.expanded {
            max-height: 500px;
        }
        
        .expense-category-tag {
            min-width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .expenses-banner {
            background: linear-gradient(135deg, #01579B 0%, #0097A7 100%);
        }
        
        .date-selector-sticky {
            background-color: #ffffff;
            border-bottom: 1px solid #f0f0f0; 
            z-index: 20; 
            top: 0; 
        }
    </style>
</head>
<body>
<div id="app" class="app-container">
    <div class="header-bg relative">
        <!-- 新增輪播區域 -->
        <div class="header-slider">
            <img v-for="(slide, index) in slides" :key="index"
                 :src="slide"
                 :class="{ 'active': currentSlide === index }"
                 class="slider-image"
                 alt="日本旅行美景">
        </div>
        
        <div class="snow-layer"></div> 
        
        <div class="side-tab-bar">
            <button @click="currentTab = 'itinerary'" title="行程" 
                    :class="{'active': currentTab === 'itinerary'}" 
                    class="tab-button">
                <i class="fa-solid fa-map-location-dot"></i>
            </button>
            
            <button @click="currentTab = 'info'" title="資訊" 
                    :class="{'active': currentTab === 'info'}" 
                    class="tab-button">
                <i class="fa-solid fa-circle-info"></i>
            </button>
            
            <button @click="currentTab = 'shopping'" title="購物" 
                    :class="{'active': currentTab === 'shopping'}" 
                    class="tab-button">
                <i class="fa-solid fa-basket-shopping"></i>
            </button>
            
            <button @click="currentTab = 'expenses'" title="花費" 
                    :class="{'active': currentTab === 'expenses'}" 
                    class="tab-button">
                <i class="fa-solid fa-coins"></i>
            </button>
        </div>
    </div>
    
    <!-- 其餘 main 內容保持不變 -->
    <main class="p-4 app-main">
        <!-- ... 原本的所有內容（行程、資訊、購物、花費）保持完全相同 ... -->
        <!-- 為了節省篇幅，這裡省略，但請從你上一個版本直接複製過來 -->
        <!-- 包括所有 v-if 區塊、日期選擇器、modal 等 -->
    </main>

    <!-- 其餘 Modal 和按鈕保持不變 -->
    <button v-if="currentTab !== 'info'" @click="handleAddClick" class="fixed bottom-6 right-6 w-14 h-14 bg-accent-yellow rounded-full fab-shadow text-deep-sea-blue text-2xl flex items-center justify-center hover:scale-110 transition-transform z-40">
        <i class="fa-solid fa-plus"></i>
    </button>

    <!-- Modal 區塊（購物、花費、行程）保持不變 -->
    <!-- 請直接從上一個完整版本複製貼上 -->
</div>

<script>
    const { createApp, ref, computed, onMounted, onUnmounted } = Vue
    createApp({
        setup() {
            // === 新增：輪播圖片與邏輯 ===
            const slides = ref([
                'https://cdn.pixabay.com/photo/2015/12/01/20/28/mountain-1072829_1280.jpg',     // 富士山
                'https://cdn.pixabay.com/photo/2017/04/09/18/54/tokyo-2216863_1280.jpg',       // 東京鐵塔夜景
                'https://cdn.pixabay.com/photo/2016/03/27/19/43/ski-1283698_1280.jpg',         // Gala Yuzawa 滑雪場
                'https://cdn.pixabay.com/photo/2017/01/08/13/58/shirakawa-go-1966439_1280.jpg', // 白川鄉
                'https://cdn.pixabay.com/photo/2018/01/28/15/23/tokyo-3113263_1280.jpg'        // 迪士尼城堡
            ])
            const currentSlide = ref(0)
            let slideInterval = null

            const nextSlide = () => {
                currentSlide.value = (currentSlide.value + 1) % slides.value.length
            }

            onMounted(() => {
                slideInterval = setInterval(nextSlide, 5000) // 每5秒切換
            })

            onUnmounted(() => {
                if (slideInterval) clearInterval(slideInterval)
            })

            // === 原有邏輯保持不變 ===
            const EXCHANGE_RATE = 0.0497
            
            const CATEGORY_MAP = {
                sightseeing: { color: 'bg-green-500', icon: 'fa-solid fa-camera' },
                food: { color: 'bg-red-500', icon: 'fa-solid fa-utensils' },
                shopping: { color: 'bg-indigo-500', icon: 'fa-solid fa-bag-shopping' },
                accommodation: { color: 'bg-purple-500', icon: 'fa-solid fa-bed' },
                flight: { color: 'bg-blue-500', icon: 'fa-solid fa-plane-departure' },
                transport: { color: 'bg-orange-500', icon: 'fa-solid fa-train-subway' },
                ticket: { color: 'bg-cyan-500', icon: 'fa-solid fa-ticket' },
                other: { color: 'bg-slate-500', icon: 'fa-solid fa-circle-info' },
                stay: { color: 'bg-purple-500', icon: 'fa-solid fa-hotel' },
            }
            const CATEGORY_LABEL_MAP = {
                sightseeing: '景點', food: '飲食', shopping: '購物', accommodation: '住宿', 
                flight: '航班', transport: '交通', ticket: '門票', other: '其他', stay: '住宿'
            }

            const currentTab = ref('itinerary')
            const selectedDateIndex = ref(0)

            // ... （其餘所有 dates, hotels, itineraryData, weatherData 等資料與上一個版本完全相同）

            // ... （所有 computed、methods、modal 邏輯與上一個版本完全相同）

            return {
                // 新增
                slides,
                currentSlide,
                
                // 原有返回項目
                currentTab, dates, selectedDateIndex, currentItinerary, hotels, weatherData,
                shoppingList, expenses, totalExpensesJPY, totalExpensesHKD,
                showShoppingModal, showExpenseModal, showItineraryModal, isEditMode,
                newShoppingItem, newExpense, newItinerary,
                currencyInput, currencyResult, calculateCurrency,
                getCategoryColor, getCategoryIcon, getCategoryLabel,
                getWeatherIcon, getWeatherDescription, getTransportIcon,
                openMap, openMapDirections, formatNumber,
                handleAddClick, handleImageUpload, addShoppingItem, removeShoppingItem,
                addExpense, removeExpense, editItem, saveItineraryItem, removeItineraryItem,
                moveItineraryUp, moveItineraryDown
            }
        }
    }).mount('#app')
</script>
</body>
</html>
